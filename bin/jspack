#!/bin/bash
set +x

BASE=$(dirname $0)
. $BASE/setenv.sh

DIRNAME="$(pwd -P)/$(dirname $1)"
BASENAME="$(basename $1 .js)"

INFILE="$DIRNAME/$BASENAME.js"
OUTFILE="$DIRNAME/$BASENAME.compressed.js"

test -f "$INFILE" || {
	echo "input file missing: $INFILE"
	exit 10
}

rm -f $OUTFILE
rm -f $OUTFILE.tmp

# perl needs this
cd $JSPACK

echo "Compressing $INFILE ... "
java -jar $SHRINKSAFE "$INFILE" | perl "$JSPACK/jsPacker.pl" -fq -e62 -i - > $OUTFILE
echo "Output: $OUTFILE"

