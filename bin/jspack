#!env python
import os
import sys
import subprocess

BASE=os.path.dirname(sys.argv[0])

shrinksafe = os.path.abspath(os.path.join(BASE, "..", "shrinksafe", "shrinksafe.jar"))
jspack     = os.path.abspath(os.path.join(BASE, "..", "jspack"))

if not os.path.exists(shrinksafe):
    print >>sys.stderr, "shrinksafe missing: ", shrinksafe
    sys.exit(5)

if not os.path.exists(jspack):
    print >>sys.stderr, "jspack missing: ", jspack
    sys.exit(5)

INFILE=sys.argv[1]

if not os.path.exists(INFILE):
    print >>sys.stderr, "infile missing: ", INFILE
    sys.exit(10)

INFILE=os.path.abspath(INFILE)
print >>sys.stderr, "INFILE : ", INFILE

OUTFILE=INFILE.replace(".js", ".compressed.js")
print >>sys.stderr, "OUTFILE: ", OUTFILE

CMD = "java -jar %(shrinksafe)s '%(INFILE)s' | perl 'jsPacker.pl' -fq -e62 -i - > %(OUTFILE)s" % locals()
print >>sys.stderr, "CMD    : ", CMD

os.chdir(jspack)
subprocess.call(CMD, shell=True)

# vim: set ft=python ts=4 sw=4 expandtab tw=78 :
